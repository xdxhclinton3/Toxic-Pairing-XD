<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Toxic MD | Session Generator</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #6366f1;
      --accent: #a855f7;
      --success: #10b981;
      --error: #ef4444;
      --bg: #030712;
      --glass: rgba(255, 255, 255, 0.03);
      --border: rgba(255, 255, 255, 0.08);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      background-color: var(--bg);
      color: #fff;
      font-family: 'Plus Jakarta Sans', sans-serif;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow-x: hidden;
      padding: 20px;
    }

    #canvas {
      position: fixed;
      inset: 0;
      z-index: -1;
      background: radial-gradient(circle at 50% 50%, #0f172a 0%, #030712 100%);
    }

    /* --- TOAST SYSTEM --- */
    #notification-container {
      position: fixed;
      top: 25px; right: 25px;
      z-index: 1000;
      display: flex; flex-direction: column; gap: 12px;
    }

    .toast {
      padding: 16px 24px;
      background: rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(12px);
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.5);
      animation: slideIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
      display: flex; align-items: center; gap: 12px; font-size: 14px;
    }

    @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

    /* --- APP SHELL --- */
    .app-shell { width: 100%; max-width: 480px; z-index: 10; }

    .main-card {
      background: var(--glass);
      backdrop-filter: blur(25px);
      border: 1px solid var(--border);
      border-radius: 32px;
      padding: 40px;
      box-shadow: 0 40px 100px rgba(0,0,0,0.6);
      position: relative;
      overflow: hidden;
    }

    .brand-identity { text-align: center; margin-bottom: 35px; }
    
    .logo-wrapper {
      width: 70px; height: 70px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      border-radius: 20px;
      margin: 0 auto 20px;
      display: flex; align-items: center; justify-content: center;
      font-size: 28px; color: white;
      box-shadow: 0 10px 25px rgba(99, 102, 241, 0.4);
      animation: logoFloat 3s ease-in-out infinite;
    }

    @keyframes logoFloat { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

    h1 { font-size: 26px; font-weight: 800; letter-spacing: -0.5px; }
    .tagline { color: #94a3b8; font-size: 14px; margin-top: 6px; }

    /* --- INPUT & BUTTONS --- */
    .phone-input {
      width: 100%;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 18px;
      color: #fff;
      font-size: 18px;
      text-align: center;
      transition: 0.3s;
      margin-bottom: 20px;
    }

    .phone-input:focus { border-color: var(--primary); background: rgba(0,0,0,0.5); box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1); outline: none; }

    .action-btn {
      width: 100%; height: 62px;
      background: #fff; color: #000;
      border: none; border-radius: 18px;
      font-size: 16px; font-weight: 800;
      cursor: pointer; position: relative;
      overflow: hidden; transition: 0.3s;
    }

    .action-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(255,255,255,0.1); }
    .action-btn:disabled { background: #1f2937; color: #4b5563; cursor: wait; }

    .loader-bar {
      position: absolute; bottom: 0; left: 0;
      height: 4px; background: linear-gradient(to right, var(--primary), var(--accent));
      width: 0%; transition: width 0.2s;
    }

    /* --- ENHANCED RESULT CARD --- */
    #result { display: none; margin-top: 25px; animation: scaleUp 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); }
    
    @keyframes scaleUp { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

    .result-card {
      background: rgba(255, 255, 255, 0.05);
      border: 2px dashed var(--primary);
      border-radius: 20px;
      padding: 24px;
      text-align: center;
    }

    .pairing-code {
      display: block;
      font-size: 42px; font-weight: 900;
      letter-spacing: 6px; color: #fff;
      margin-bottom: 15px; text-shadow: 0 0 20px rgba(99, 102, 241, 0.5);
    }

    .copy-button {
      background: var(--primary);
      color: white; border: none;
      padding: 12px 24px; border-radius: 12px;
      font-weight: 700; font-size: 14px;
      cursor: pointer; display: inline-flex;
      align-items: center; gap: 8px;
      transition: 0.2s;
    }

    .copy-button:hover { background: var(--accent); transform: scale(1.05); }

    /* --- STEPS --- */
    .instructions { margin-top: 30px; }
    .step { display: flex; gap: 15px; margin-bottom: 18px; font-size: 14px; color: #94a3b8; }
    .step-num {
      width: 24px; height: 24px; background: var(--primary);
      border-radius: 8px; flex-shrink: 0;
      display: flex; align-items: center; justify-content: center;
      font-size: 12px; font-weight: 800; color: #fff;
    }
    .step b { color: #fff; }

  </style>
</head>
<body>

  <canvas id="canvas"></canvas>
  <div id="notification-container"></div>

  <div class="app-shell">
    <div class="main-card">
      <div class="brand-identity">
        <div class="logo-wrapper"><i class="fas fa-shield-halved"></i></div>
        <h1>Toxic MD Link</h1>
        <p class="tagline">Official Device Pairing Hub</p>
      </div>

      <div class="input-section">
        <input type="tel" id="number" class="phone-input" placeholder="2547XXXXXXXX">
        <button class="action-btn" id="submit-btn">
          <span id="btn-text">Generate Secure Code</span>
          <div class="loader-bar" id="loader-bar"></div>
        </button>
      </div>

      <div id="result"></div>

      <div class="instructions">
        <div class="step">
          <div class="step-num">1</div>
          <span>Enter <b>Phone Number</b> with country code.</span>
        </div>
        <div class="step">
          <div class="step-num">2</div>
          <span>Wait for the <b>8-Digit Code</b> to generate.</span>
        </div>
        <div class="step">
          <div class="step-num">3</div>
          <span>Link via <b>WhatsApp Settings</b> on your phone.</span>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.0.0-alpha.1/axios.min.js"></script>
  <script>
    // --- CONNECTED CANVAS BG ---
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let particles = [];

    function init() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      particles = Array.from({length: 50}, () => ({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        vx: (Math.random() - 0.5) * 0.5,
        vy: (Math.random() - 0.5) * 0.5
      }));
    }

    function animate() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      particles.forEach(p => {
        p.x += p.vx; p.y += p.vy;
        if(p.x<0 || p.x>canvas.width) p.vx*=-1;
        if(p.y<0 || p.y>canvas.height) p.vy*=-1;
        ctx.fillStyle = 'rgba(99, 102, 241, 0.2)';
        ctx.beginPath(); ctx.arc(p.x, p.y, 2, 0, Math.PI*2); ctx.fill();
      });
      requestAnimationFrame(animate);
    }
    window.addEventListener('resize', init);
    init(); animate();

    // --- TOASTS ---
    function notify(msg, type = 'success') {
      const container = document.getElementById('notification-container');
      const toast = document.createElement('div');
      toast.className = 'toast';
      const icon = type === 'success' ? 'fa-circle-check' : 'fa-circle-exclamation';
      const color = type === 'success' ? '#10b981' : '#ef4444';
      toast.innerHTML = `<i class="fa-solid ${icon}" style="color: ${color}"></i> ${msg}`;
      container.appendChild(toast);
      setTimeout(() => {
        toast.style.transform = 'translateX(120%)';
        setTimeout(() => toast.remove(), 500);
      }, 3000);
    }

    // --- PAIRING LOGIC ---
    const submitBtn = document.getElementById('submit-btn');
    const btnText = document.getElementById('btn-text');
    const loaderBar = document.getElementById('loader-bar');
    const resultDiv = document.getElementById('result');

    submitBtn.addEventListener('click', async () => {
      const number = document.getElementById('number').value.replace(/[^0-9]/g, '');
      if (number.length < 10) return notify("Please enter a valid phone number", "error");

      // UI Reset
      submitBtn.disabled = true;
      btnText.innerText = "INITIALIZING UPLINK...";
      resultDiv.style.display = 'none';
      
      let progress = 0;
      const interval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress > 98) progress = 98;
        loaderBar.style.width = progress + '%';
        if(progress > 40) btnText.innerText = "GENERATING CODE...";
        if(progress > 80) btnText.innerText = "FINALIZING...";
      }, 200);

      try {
        const response = await axios.get(`/code?number=${number}`);
        const code = response.data.code;
        
        clearInterval(interval);
        loaderBar.style.width = '100%';
        
        setTimeout(() => {
          btnText.innerText = "GENERATE SECURE CODE";
          loaderBar.style.width = '0%';
          submitBtn.disabled = false;
          
          resultDiv.innerHTML = `
            <div class="result-card">
              <span class="pairing-code">${code}</span>
              <button class="copy-button" onclick="copyCode('${code}')">
                <i class="fa-regular fa-copy"></i> COPY CODE
              </button>
            </div>
          `;
          resultDiv.style.display = 'block';
          notify("Pairing Code Ready!");
        }, 600);
      } catch (err) {
        clearInterval(interval);
        submitBtn.disabled = false;
        loaderBar.style.width = '0%';
        btnText.innerText = "GENERATE SECURE CODE";
        notify("Server Busy. Try again later.", "error");
      }
    });

    window.copyCode = (code) => {
      navigator.clipboard.writeText(code);
      const copyBtn = document.querySelector('.copy-button');
      copyBtn.innerHTML = `<i class="fa-solid fa-check"></i> COPIED!`;
      copyBtn.style.background = '#10b981';
      notify("Copied to clipboard!");
      setTimeout(() => {
        copyBtn.innerHTML = `<i class="fa-regular fa-copy"></i> COPY CODE`;
        copyBtn.style.background = 'var(--primary)';
      }, 2000);
    };
  </script>
</body>
</html>
